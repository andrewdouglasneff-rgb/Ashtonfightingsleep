<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ashton Fighting Sleep</title>
<style>
  :root{--bg:#0b0c0e;--fg:#e9eef5;--muted:#9aa4b2;}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  .title{position:fixed;top:8px;left:50%;transform:translateX(-50%);padding:12px 28px;background:rgba(16,18,24,.85);border:2px solid #1a1f2b;border-radius:999px;font-weight:900;letter-spacing:.6px;z-index:9;font-size:42px;} /* 3x larger */
  .wrap{display:grid;place-items:center;height:100%;padding:20px 12px;}
  canvas{width:min(96vw,960px);height:auto;border:1px solid #1a1f2b;border-radius:14px;background:#0f1115;box-shadow:0 10px 30px rgba(0,0,0,.35);}
  .hud{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(16,18,24,.85);border:1px solid #1a1f2b;border-radius:999px;padding:6px 12px;display:flex;gap:12px;align-items:center;font-size:14px;z-index:9;}
  .btnbar button{appearance:none;border:1px solid #1a1f2b;background:#0f121a;color:var(--fg);padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;}
  .hint{position:absolute;inset:0;display:grid;place-items:center;color:#9aa4b2;pointer-events:none;font-weight:700;}
  .miss{position:fixed;top:16px;right:16px;width:252px;height:252px;border-radius:50%;border:4px solid #1a1f2b;background:rgba(16,18,24,.6);display:grid;place-items:center;z-index:9;} /* 3x larger */
  .miss img{width:240px;height:240px;border-radius:50%;object-fit:cover;}
</style>
</head>
<body>
  <div class="title">Ashton Fighting Sleep</div>
  <div class="miss"><img src="miss.png" alt="Miss Rachel"></div>
  <div class="wrap">
    <canvas id="game" width="900" height="260"></canvas>
    <div id="hint" class="hint">Tap/Space to Start · Tap/Space to Jump</div>
    <div class="hud">
      <span>Score: <b id="score">0</b></span>
      <span>Best: <b id="best">0</b></span>
      <span>Speed: <b id="spd">1.0x</b></span>
      <span class="btnbar">
        <button id="startBtn">Start</button>
        <button id="pauseBtn">Pause</button>
        <button id="jumpBtn">Jump</button>
      </span>
    </div>
  </div>

<script>
(() => {
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');
  const spdEl = document.getElementById('spd');
  const hint = document.getElementById('hint');

  const imgBaby = new Image(); imgBaby.src = 'baby.png';
  const imgCrib = new Image(); imgCrib.src = 'crib.webp';
  const imgHall = new Image(); imgHall.src = 'hallway.png';

  const GROUND_Y = 200;
  const GRAVITY = 1800;
  const JUMP_VY = -650;
  const MIN_GAP = 360, MAX_GAP = 560;
  const BASE_SPEED = 320;
  const SPEED_GAIN = 0.06;
  const BG_SPEED = 120;

  let running=false, paused=false, gameOver=false;
  let tPrev=0, distance=0, speed=BASE_SPEED, score=0, best=+localStorage.getItem('afs-best')||0;
  bestEl.textContent = best;

  let bgOffset = 0;

  const player = {
    x: 90, y: GROUND_Y-96, w: 64, h: 96, vy:0, onGround:true, blink:0,
    jump(){ if(!running||paused) return; if(this.onGround){ this.vy=JUMP_VY; this.onGround=false; } },
    reset(){ this.y=GROUND_Y-96; this.vy=0; this.onGround=true; this.blink=0; }
  };

  let obstacles = [];
  let spawnX = cvs.width + 80;

  function spawnObstacle(x){
    const scale = 0.9 + Math.random()*0.3;
    const w = Math.round(300*scale), h = Math.round(220*scale);
    obstacles.push({ x, y: GROUND_Y - h + 6, w, h, hit:false });
  }

  function maybeSpawn(dt){
    if(obstacles.length===0){ spawnObstacle(spawnX); spawnX += (MIN_GAP + Math.random()*(MAX_GAP-MIN_GAP)); }
    else {
      const last = obstacles[obstacles.length-1];
      if(last.x + last.w < cvs.width) {
        if(spawnX - last.x > (MIN_GAP + Math.random()*(MAX_GAP-MIN_GAP))) {
          spawnObstacle(spawnX);
          spawnX += (MIN_GAP + Math.random()*(MAX_GAP-MIN_GAP));
        }
      }
    }
  }

  function start(){
    running=true; paused=false; gameOver=false;
    tPrev=performance.now(); distance=0; speed=BASE_SPEED; score=0;
    obstacles=[]; spawnX = cvs.width + 80; player.reset(); hint.textContent='';
    loop(performance.now());
  }

  function end(){
    running=false; gameOver=true;
    best=Math.max(best, Math.floor(score)); localStorage.setItem('afs-best', best); bestEl.textContent=best;
    hint.textContent='Nap time! Game Over — Start to try again';
  }

  function togglePause(){
    if(!running) return; paused=!paused;
    hint.textContent = paused ? 'Paused (P) · Tap/Space to jump' : '';
    document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
  }

  addEventListener('keydown', (e)=>{
    if(e.repeat) return;
    if(e.code==='Space' || e.code==='ArrowUp'){ e.preventDefault(); if(!running) start(); else player.jump(); }
    if(e.code==='KeyP') togglePause();
    if(e.code==='Enter') if(gameOver) start();
  }, {passive:false});
  document.getElementById('startBtn').onclick=()=>start();
  document.getElementById('pauseBtn').onclick=()=>togglePause();
  document.getElementById('jumpBtn').onclick=()=>player.jump();
  cvs.addEventListener('pointerdown', ()=>{ if(!running) start(); else player.jump(); });

  function rectsOverlap(a,b){
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
  }

  function update(dt){
    if(paused||!running) return;

    speed += SPEED_GAIN * dt * 10;
    spdEl.textContent = (speed/BASE_SPEED).toFixed(1)+'x';

    if(imgHall.width) bgOffset = (bgOffset - BG_SPEED*dt) % imgHall.width;

    player.vy += GRAVITY * dt;
    player.y += player.vy * dt;
    if(player.y + player.h >= GROUND_Y){ player.y = GROUND_Y - player.h; player.vy=0; player.onGround=true; }

    for(const o of obstacles) {
      o.x -= speed * dt;
      if(!o.hit && rectsOverlap(player, o)) { o.hit=true; player.blink=0.3; end(); }
    }
    obstacles = obstacles.filter(o => o.x + o.w > -80);

    distance += speed * dt;
    score = Math.floor(distance / 8);
    scoreEl.textContent = score;

    maybeSpawn(dt);
  }

  function drawBackground(){
    if(!imgHall.complete) return;
    const w = imgHall.width, h = imgHall.height;
    for(let x = bgOffset; x < cvs.width + w; x += w) {
      ctx.drawImage(imgHall, x, 0);
    }
    ctx.strokeStyle = '#2a2f3a'; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(0, GROUND_Y + 0.5); ctx.lineTo(cvs.width, GROUND_Y + 0.5); ctx.stroke();
  }

  function render(){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    drawBackground();

    for(const o of obstacles) {
      if(imgCrib.complete) ctx.drawImage(imgCrib, o.x, o.y, o.w, o.h);
      else { ctx.fillStyle='#ccc'; ctx.fillRect(o.x,o.y,o.w,o.h); }
    }

    ctx.save();
    if(player.blink>0){ ctx.globalAlpha = 0.3 + 0.7*Math.sin(Date.now()/35); player.blink=Math.max(0, player.blink-0.016); }
    if(imgBaby.complete) ctx.drawImage(imgBaby, player.x, player.y, player.w, player.h);
    else { ctx.fillStyle='#6c6'; ctx.fillRect(player.x,player.y,player.w,player.h); }
    ctx.restore();
  }

  function loop(tNow){
    if(!running) { render(); return; }
    const dt = Math.min(0.033, (tNow - tPrev) / 1000);
    tPrev = tNow;
    update(dt); render();
    requestAnimationFrame(loop);
  }

  render();
})();
</script>
</body>
</html>
